<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>CryptoNova - Login/Register & Dashboard</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #121212;
      color: #eee;
      margin: 0; padding: 0;
      display: flex;
      justify-content: center;
      align-items: flex-start;
      min-height: 100vh;
      padding-top: 50px;
    }
    .container {
      background: #222;
      padding: 20px 30px;
      border-radius: 8px;
      width: 350px;
      margin-top: 40px;
      box-shadow: 0 0 15px rgba(0, 0, 0, 0.7);
    }
    h2 {
      margin-top: 0;
      text-align: center;
      color: #4fc3f7;
    }
    input, select {
      width: 100%;
      padding: 10px;
      margin: 10px 0 15px 0;
      border-radius: 5px;
      border: none;
      font-size: 1em;
    }
    button {
      width: 100%;
      background: #4fc3f7;
      border: none;
      padding: 12px;
      font-size: 1.1em;
      color: #222;
      border-radius: 5px;
      cursor: pointer;
      transition: background 0.3s ease;
    }
    button:hover {
      background: #29b6f6;
    }
    .toggle-link {
      color: #4fc3f7;
      cursor: pointer;
      text-align: center;
      display: block;
      margin-top: 10px;
      font-size: 0.9em;
    }
    .message {
      text-align: center;
      margin-bottom: 10px;
      font-weight: bold;
    }
    .error {
      color: #ff5555;
    }
    .success {
      color: #55ff55;
    }
    .dashboard-info {
      margin-bottom: 20px;
    }
    .dashboard-info p {
      margin: 6px 0;
      font-size: 1.05em;
    }
    label {
      font-weight: bold;
    }
    small {
      display: block;
      margin-top: -10px;
      margin-bottom: 10px;
      font-size: 0.8em;
      color: #aaa;
    }
    #mobile-instructions {
      background: #333;
      color: #eee;
      padding: 12px;
      text-align: center;
      font-size: 0.9em;
      display: none;
      position: fixed;
      top: 0; left: 0; right: 0;
      z-index: 1000;
    }
  </style>
</head>
<body>

<div id="mobile-instructions">
  For full wallet features on mobile, open this site inside the Trust Wallet or MetaMask appâ€™s DApp browser.
</div>

<div class="container" id="auth-container">
  <h2 id="form-title">Login to CryptoNova</h2>
  <div id="message" class="message"></div>
  <form id="auth-form">
    <input type="email" id="email" placeholder="Email" required />
    <input type="password" id="password" placeholder="Password" required />
    <button type="submit">Login</button>
  </form>
  <span class="toggle-link" id="toggle-link">Don't have an account? Register</span>
</div>

<div class="container" id="dashboard-container" style="display:none; max-width:400px;">
  <h2>Welcome, <span id="user-name"></span>!</h2>
  
  <div id="wallet-section" style="margin-bottom: 20px;">
    <button id="connect-wallet-btn">Connect Wallet (MetaMask/TrustWallet)</button>
    <p id="wallet-address" style="margin-top:10px; font-size: 0.9em; color: #ccc;"></p>
  </div>
  
  <div class="dashboard-info">
    <p><strong>Balance:</strong> <span id="balance">0</span> SHAAUKAAR tokens</p>
    <p><strong>Staked:</strong> <span id="staked">0</span> SHAAUKAAR tokens</p>
    <p><strong>Rewards:</strong> <span id="rewards">0</span> SHAAUKAAR tokens</p>
  </div>
  
  <form id="buy-form">
    <label for="buy-amount">Buy SHAAUKAAR Amount:</label>
    <input type="number" id="buy-amount" min="1" placeholder="Amount" required />
    
    <label for="currency">Currency:</label>
    <select id="currency" required>
      <option value="" disabled selected>Select currency</option>
      <option value="USD">USD</option>
      <option value="EUR">EUR</option>
      <option value="BTC">BTC</option>
      <option value="ETH">ETH</option>
      <option value="USDT">USDT</option>
      <option value="BNB">BNB</option>
      <option value="SOL">SOL</option>
      <option value="TRX">TRX</option>
      <option value="XRP">XRP</option>
      <option value="USDC">USDC</option>
      <option value="ADA">ADA</option>
    </select>
    <button type="submit">Buy SHAAUKAAR</button>
  </form>
  
  <form id="stake-form" style="margin-top: 20px;">
    <label for="stake-amount">Stake SHAAUKAAR:</label>
    <input type="number" id="stake-amount" min="1" placeholder="Amount to stake" required />
    <button type="submit">Stake</button>
  </form>
  
  <button id="logout-btn" style="margin-top: 20px; background: #f44336; color:#fff;">Logout</button>
</div>

<script>
  function isMobile() {
    return /Android|iPhone|iPad|iPod/i.test(navigator.userAgent);
  }
  window.addEventListener("load", () => {
    if (isMobile() && !window.ethereum) {
      document.getElementById("mobile-instructions").style.display = "block";
    }
  });

  const authContainer = document.getElementById("auth-container");
  const dashboardContainer = document.getElementById("dashboard-container");
  const formTitle = document.getElementById("form-title");
  const authForm = document.getElementById("auth-form");
  const toggleLink = document.getElementById("toggle-link");
  const messageDiv = document.getElementById("message");

  const connectWalletBtn = document.getElementById("connect-wallet-btn");
  const walletAddressP = document.getElementById("wallet-address");

  let isLogin = true;

  function getUsers() {
    return JSON.parse(localStorage.getItem("users") || "[]");
  }
  function saveUsers(users) {
    localStorage.setItem("users", JSON.stringify(users));
  }
  function setLoggedInUser(email) {
    localStorage.setItem("loggedInUser", email);
  }
  function getLoggedInUser() {
    return localStorage.getItem("loggedInUser");
  }
  function logoutUser() {
    localStorage.removeItem("loggedInUser");
  }

  function getUserData(email) {
    const data = localStorage.getItem("userData_" + email);
    return data ? JSON.parse(data) : { balance: 0, staked: 0, rewards: 0 };
  }
  function saveUserData(email, data) {
    localStorage.setItem("userData_" + email, JSON.stringify(data));
  }

  function getStoredWallet(email) {
    return localStorage.getItem("wallet_" + email) || "";
  }
  function storeWallet(email, address) {
    localStorage.setItem("wallet_" + email, address);
  }

  function showMessage(text, type = "") {
    messageDiv.textContent = text;
    messageDiv.className = "message " + type;
  }

  toggleLink.addEventListener("click", () => {
    isLogin = !isLogin;
    showMessage("");
    if (isLogin) {
      formTitle.textContent = "Login to CryptoNova";
      authForm.innerHTML = `
        <input type="email" id="email" placeholder="Email" required />
        <input type="password" id="password" placeholder="Password" required />
        <button type="submit">Login</button>
      `;
      toggleLink.textContent = "Don't have an account? Register";
    } else {
      formTitle.textContent = "Register on CryptoNova";
      authForm.innerHTML = `
        <input type="email" id="email" placeholder="Email" required />
        <input type="password" id="password" placeholder="Password" required />
        <input type="text" id="verification" placeholder="Email Verification Code (123456)" required />
        <button type="submit">Register</button>
        <small>Use verification code: 123456</small>
      `;
      toggleLink.textContent = "Already have an account? Login";
    }
  });

  function showDashboard() {
    const email = getLoggedInUser();
    if (!email) {
      authContainer.style.display = "block";
      dashboardContainer.style.display = "none";
      return;
    }
    const users = getUsers();
    const user = users.find(u => u.email === email);
    if (!user) {
      logoutUser();
      authContainer.style.display = "block";
      dashboardContainer.style.display = "none";
      return;
    }
    authContainer.style.display = "none";
    dashboardContainer.style.display = "block";

    document.getElementById("user-name").textContent = email;

    const data = getUserData(email);
    updateDashboardBalances(data);

    const wallet = getStoredWallet(email);
    showWalletAddress(wallet);
  }

  function updateDashboardBalances(data) {
    document.getElementById("balance").textContent = data.balance.toFixed(4);
    document.getElementById("staked").textContent = data.staked.toFixed(4);
    document.getElementById("rewards").textContent = data.rewards.toFixed(4);
  }

  function showWalletAddress(address) {
    if (address) {
      walletAddressP.textContent = "Connected wallet: " + address;
      connectWalletBtn.textContent = "Disconnect Wallet";
    } else {
      walletAddressP.textContent = "";
      connectWalletBtn.textContent = "Connect Wallet (MetaMask/TrustWallet)";
    }
  }

  authForm.addEventListener("submit", e => {
    e.preventDefault();
    showMessage("");

    const email = authForm.querySelector("#email").value.trim().toLowerCase();
    const password = authForm.querySelector("#password").value;

    if (isLogin) {
      const users = getUsers();
      const user = users.find(u => u.email === email);
      if (!user) {
        showMessage("User not found.", "error");
        return;
      }
      if (user.password !== password) {
        showMessage("Incorrect password.", "error");
        return;
      }
      setLoggedInUser(email);
      showMessage("Login successful!", "success");
      showDashboard();
    } else {
      const verification = authForm.querySelector("#verification").value.trim();
      if (verification !== "123456") {
        showMessage("Incorrect verification code.", "error");
        return;
      }
      const users = getUsers();
      if (users.some(u => u.email === email)) {
        showMessage("Email already registered.", "error");
        return;
      }
      users.push({
        email,
        password
      });
      saveUsers(users);
      setLoggedInUser(email);
      saveUserData(email, { balance: 0, staked: 0, rewards: 0 });
      showMessage("Registration successful! Logged in.", "success");
      showDashboard();
    }
  });

  document.getElementById("buy-form").addEventListener("submit", e => {
    e.preventDefault();
    const amount = parseFloat(document.getElementById("buy-amount").value);
    const currency = document.getElementById("currency").value;
    if (isNaN(amount) || amount <= 0) {
      alert("Enter a valid amount to buy.");
      return;
    }
    if (!currency) {
      alert("Please select a currency.");
      return;
    }
    const email = getLoggedInUser();
    if (!email) {
      alert("Please login first.");
      return;
    }
    let tokensToAdd = 0;
    switch (currency) {
      case "USD": tokensToAdd = amount; break;
      case "EUR": tokensToAdd = amount * 1.1; break;
      case "BTC": tokensToAdd = amount * 50000; break;
      case "ETH": tokensToAdd = amount * 4000; break;
      case "USDT": tokensToAdd = amount * 1; break;
      case "BNB": tokensToAdd = amount * 300; break;
      case "SOL": tokensToAdd = amount * 20; break;
      case "TRX": tokensToAdd = amount * 0.07; break;
      case "XRP": tokensToAdd = amount * 0.5; break;
      case "USDC": tokensToAdd = amount * 1; break;
      case "ADA": tokensToAdd = amount * 1.5; break;
      default: tokensToAdd = amount; break;
    }
    const data = getUserData(email);
    data.balance += tokensToAdd;
    saveUserData(email, data);
    updateDashboardBalances(data);
    alert(`You bought ${tokensToAdd.toFixed(4)} SHAAUKAAR tokens!`);
    e.target.reset();
  });

  document.getElementById("stake-form").addEventListener("submit", e => {
    e.preventDefault();
    const stakeAmount = parseFloat(document.getElementById("stake-amount").value);
    if (isNaN(stakeAmount) || stakeAmount <= 0) {
      alert("Enter a valid amount to stake.");
      return;
    }
    const email = getLoggedInUser();
    if (!email) {
      alert("Please login first.");
      return;
    }
    const data = getUserData(email);
    if (stakeAmount > data.balance) {
      alert("You don't have enough balance to stake that amount.");
      return;
    }
    data.balance -= stakeAmount;
    data.staked += stakeAmount;
    const reward = stakeAmount * 0.001;
    data.rewards += reward;
    saveUserData(email, data);
    updateDashboardBalances(data);
    alert(`Successfully staked ${stakeAmount.toFixed(4)} SHAAUKAAR tokens and earned ${reward.toFixed(4)} SHAAUKAAR tokens as rewards!`);
    e.target.reset();
  });

  document.getElementById("logout-btn").addEventListener("click", () => {
    logoutUser();
    showMessage("You have logged out.", "success");
    showDashboard();
  });

  connectWalletBtn.addEventListener("click", async () => {
    const email = getLoggedInUser();
    if (!email) {
      alert("Please login first.");
      return;
    }
    const currentWallet = getStoredWallet(email);
    if (currentWallet) {
      storeWallet(email, "");
      showWalletAddress("");
    } else {
      if (window.ethereum) {
        try {
          const accounts = await window.ethereum.request({ method: "eth_requestAccounts" });
          storeWallet(email, accounts[0]);
          showWalletAddress(accounts[0]);
        } catch (error) {
          alert("Wallet connection rejected or failed.");
        }
      } else {
        alert("No Ethereum wallet detected. Please install MetaMask or use TrustWallet DApp browser.");
      }
    }
  });

  window.onload = () => {
    if (getLoggedInUser()) {
      showDashboard();
    }
  };
</script>

</body>
</html>
